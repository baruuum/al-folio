---
layout: post
title: Number of Four-cycles in Networks
date: 2017-06-26 21:48
author: baruuum
comments: false
categories: [Graph Theory, R]
---

I'm in the middle of moving my website from WordPress to Github Pages. I've exported my posts on WordPress into a `.xml` file and have used [this great program](https://github.com/theaob/wpXml2Jekyll) to transform the pages into Markdown documents. One problem that remains is translating equations from the blogs in Wordpress to those in Jekyll. So, I'm trying different things out. So, here is a test (by the way, the reason for working on this weird mathematical problem, if I remember correctly, was the amazing <em>AJS</em> article by Peter Bearman, James Moody, and Katherine Stovel on the sexual network of high school students).

<hr />

#### Number of Four-Cycles in a Graph

Let {% katex %} G=(V,E) {% endkatex %} be a graph with associated adjacency matrix {% katex %} A {% endkatex %}. Consider a closed walk of length 4 starting at the vertex {% katex %} v_1\in V {% endkatex %}. We have to consider four different scenarios:

- for each {% katex %} v_j {% endkatex %} adjacent to {% katex %} v_i {% endkatex %}, there exists a length-four walk {% katex %} \{v_i, v_j,v_i,v_j,v_i\} {% endkatex %} which is obviously no 4-cycle. The number of such length-four walks are equal to the degree of {% katex %} v_i {% endkatex %};

- if {% katex %} \{v_i,v_j\}, \{v_j,v_k\} \in E(V) {% endkatex %}, {% katex %} i\ne j\ne k {% endkatex %}, then {% katex %} \{v_i,v_j,v_k,v_j,v_i\} {% endkatex %} is a walk of length 4 but no 4-cycle. The number of such walks is equal the degree of {% katex %} v_j {% endkatex %} minus one (the tie to {% katex %} v_i {% endkatex %});

- if {% katex %} v_i {% endkatex %} has more than one neighbor, then {% katex %} \{v_i,v_j,v_i,v_k,v_i\} {% endkatex %} is also a walk of length 4, but not a cycle. For a vertex with more than one neighbor, the number of these walks are given as {% katex %} 2\binom{deg(v_i)}{2} {% endkatex %};

- if {% katex %} \{v_i,v_j,v_k,v_l,v_i\} {% endkatex %} is a length-4 closed walk visiting distinct vertices, then so is {% katex %} \{v_i,v_l,v_k,v_j,v_i\} {% endkatex %}. Hence we are always double counting.


Let {% katex %} N=\{i: v_i \in V(G)\} {% endkatex %} be an index set and denote the degree of vertex {% katex %} v_i {% endkatex %} as {% katex %} d_G(v_i) {% endkatex %}. If we let {% katex %} c_i {% endkatex %} be the number of 4-cycles in which node {% katex %} i {% endkatex %} is involved, then

{% katex display %}  \begin{aligned} a_{ii}^{(4)} &= 2 c_i + d_G(v_i) + \sum_{j\in N}a_{ij}\Big(d_G(v_j)-1\Big) + 2\binom{d_G(v_i)}{2} \\ &= 2 c_i + d_G(v_i) + \sum_{j\in N}a_{ij}\left(\sum_{k\in N}a_{jk} -1\right) + 2\binom{d_G(v_i)}{2} \\ &= 2 c_i + \sum_{k\in N}a_{ik}^{(2)} + 2\binom{d_G(v_i)}{2} \end{aligned}  {% endkatex %}

as {% katex %} d_G(v_i) = \sum_{j\in N}a_{ij} {% endkatex %}. Hence,

{% katex display %}  \begin{aligned} c_i&= \frac{1}{2}\left(a_{ii}^{(4)} - \sum_{j\in N}a_{ij}^{(2)} - 2\binom{d_{G}(v_i)}{2}\right). \end{aligned}  {% endkatex %}

Since each cycle of length 4 consists of four vertices, it follows that the number of 4-cycles {% katex %} |\mathcal C_4| {% endkatex %} in {% katex %} G {% endkatex %} is

{% katex display %}  \begin{aligned} |\mathcal C_4(G)| &= \frac{1}{4}\left[\sum_{i\in N} \frac{1}{2}\left(a_{ii}^{(4)} - \sum_{j\in N}a_{ij}^{(2)} - 2\binom{d_{G}(v_i)}{2}\right)\right] \\ &= \frac{1}{8}\left[\sum_{i\in N} a_{ii}^{(4)} - \sum_{i,j\in N}a_{ij}^{(2)} - 2\sum_{i\in N}\binom{d_{G}(v_i)}{2}\right]. \end{aligned}  {% endkatex %}

Now, we notice that the first term is the trace of the matrix {% katex %} A^4 {% endkatex %} and that {% katex %} \sum_{i\in N} d_G(v_i) = 2|E(G)| {% endkatex %}. Further,

{% katex display %}  \begin{aligned} \sum_{i,j\in N}a_{ij}^{(2)} &= \sum_{i\in N} a_{ii}^{(2)}+ 2\sum_{i\ne j \land i,j \in N}a_{ij}^{(2)} \\ &=\sum_{i\in N} d_G(v_i) + 2\sum_{i\in N}\binom{d_G(v_i)}{2}, \end{aligned}  {% endkatex %}

i.e., the sum of the elements in {% katex %} A^2 {% endkatex %} is equal to the diagonals plus the off-diagonals. But the sum of the diagonals is equal to the sum of the degree sequence of the graph and the sum of the off-diagonals is equal to the number of length-2 paths. The number of length-2 paths can be calculated, in turn, as follows: choose a vertex, say {% katex %} v_i {% endkatex %}; if the vertex has a degree greater than one, calculate the number of ways in which any two neighbors of {% katex %} v_i {% endkatex %} can be chosen, each of which determines a unique length-2 path for which {% katex %} v_i {% endkatex %} lies at the center. Summing over this number for all vertices in the graph gives the number of length-2 paths, as no two different vertices can lie at the center of the same length-2 path. On the other hand, if {% katex %} d_G(v_i) \le 1 {% endkatex %}, {% katex %} \binom{d_G(v_i)}{2}=0 {% endkatex %}.

Therefore it follows that

{% katex display %}  \begin{aligned} |\mathcal C_4(G)|&= \frac{1}{8}\left( \text{trace}(A^4) - 2|E(G)| - 4\sum_{i}\binom{d_G(v_i)}{2}\right). \end{aligned}  {% endkatex %}

<hr />

Works great! The `R` code that was used is shown below:

{% highlight r linenos %}
library("magrittr")

# file names
fn <- "filname.md"
out <- "output.md"

# convert equations
x <- readLines(fn) %>%
    gsub("&amp;fg=0*", "", .) %>%
    gsub("&amp;=&amp;", "&=", .) %>%
    gsub("(<\\s*p.*?>)(.*?)(<\\s*/p\\s*>)", "\\2", .) %>%
    gsub("(\\$\\s*latex\\s*\\\\displaystyle)(.*?)(\\$)", 
         "\n\n$$ \\2 \n\n", .) %>%
    gsub("\\\\begin\\{array\\}\\{.*?\\}", "\\\\begin{aligned}", .) %>%
    gsub("\\\\end\\{array\\}", "\\\\end{aligned}", .) %>%
    gsub("(\\$\\s*latex\\s*\\{)(.*?)(\\}\\s*\\$)", "$$ \\2 $$", .)

# check
cat(x)

# write out
writeLines(x, out)
{% endhighlight %}

